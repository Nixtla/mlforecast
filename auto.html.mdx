---
output-file: auto.html
title: Auto
---


------------------------------------------------------------------------

<a
href="https://github.com/Nixtla/mlforecast/blob/main/mlforecast/auto.py#L226"
target="_blank" style={{ float: "right", fontSize: "smaller" }}>source</a>

### AutoRandomForest

> ``` text
>  AutoRandomForest (config:Optional[Callable[[optuna.trial._trial.Trial],Di
>                    ct[str,Any]]]=None)
> ```

*Structure to hold a model and its search space*

|        | **Type** | **Default** | **Details**                                                      |
|------|------------------|-------------------------|-------------------------|
| config | Optional | None        | function that takes an optuna trial and produces a configuration |

------------------------------------------------------------------------

<a
href="https://github.com/Nixtla/mlforecast/blob/main/mlforecast/auto.py#L213"
target="_blank" style={{ float: "right", fontSize: "smaller" }}>source</a>

### AutoElasticNet

> ``` text
>  AutoElasticNet (config:Optional[Callable[[optuna.trial._trial.Trial],Dict
>                  [str,Any]]]=None)
> ```

*Structure to hold a model and its search space*

|        | **Type** | **Default** | **Details**                                                      |
|------|------------------|-------------------------|-------------------------|
| config | Optional | None        | function that takes an optuna trial and produces a configuration |

------------------------------------------------------------------------

<a
href="https://github.com/Nixtla/mlforecast/blob/main/mlforecast/auto.py#L200"
target="_blank" style={{ float: "right", fontSize: "smaller" }}>source</a>

### AutoLasso

> ``` text
>  AutoLasso (config:Optional[Callable[[optuna.trial._trial.Trial],Dict[str,
>             Any]]]=None)
> ```

*Structure to hold a model and its search space*

|        | **Type** | **Default** | **Details**                                                      |
|------|------------------|-------------------------|-------------------------|
| config | Optional | None        | function that takes an optuna trial and produces a configuration |

------------------------------------------------------------------------

<a
href="https://github.com/Nixtla/mlforecast/blob/main/mlforecast/auto.py#L187"
target="_blank" style={{ float: "right", fontSize: "smaller" }}>source</a>

### AutoRidge

> ``` text
>  AutoRidge (config:Optional[Callable[[optuna.trial._trial.Trial],Dict[str,
>             Any]]]=None)
> ```

*Structure to hold a model and its search space*

|        | **Type** | **Default** | **Details**                                                      |
|------|------------------|-------------------------|-------------------------|
| config | Optional | None        | function that takes an optuna trial and produces a configuration |

------------------------------------------------------------------------

<a
href="https://github.com/Nixtla/mlforecast/blob/main/mlforecast/auto.py#L174"
target="_blank" style={{ float: "right", fontSize: "smaller" }}>source</a>

### AutoLinearRegression

> ``` text
>  AutoLinearRegression (config:Optional[Callable[[optuna.trial._trial.Trial
>                        ],Dict[str,Any]]]=None)
> ```

*Structure to hold a model and its search space*

|        | **Type** | **Default** | **Details**                                                      |
|------|------------------|-------------------------|-------------------------|
| config | Optional | None        | function that takes an optuna trial and produces a configuration |

------------------------------------------------------------------------

<a
href="https://github.com/Nixtla/mlforecast/blob/main/mlforecast/auto.py#L161"
target="_blank" style={{ float: "right", fontSize: "smaller" }}>source</a>

### AutoCatboost

> ``` text
>  AutoCatboost (config:Optional[Callable[[optuna.trial._trial.Trial],Dict[s
>                tr,Any]]]=None)
> ```

*Structure to hold a model and its search space*

|        | **Type** | **Default** | **Details**                                                      |
|------|------------------|-------------------------|-------------------------|
| config | Optional | None        | function that takes an optuna trial and produces a configuration |

------------------------------------------------------------------------

<a
href="https://github.com/Nixtla/mlforecast/blob/main/mlforecast/auto.py#L148"
target="_blank" style={{ float: "right", fontSize: "smaller" }}>source</a>

### AutoXGBoost

> ``` text
>  AutoXGBoost (config:Optional[Callable[[optuna.trial._trial.Trial],Dict[st
>               r,Any]]]=None)
> ```

*Structure to hold a model and its search space*

|        | **Type** | **Default** | **Details**                                                      |
|------|------------------|-------------------------|-------------------------|
| config | Optional | None        | function that takes an optuna trial and produces a configuration |

------------------------------------------------------------------------

<a
href="https://github.com/Nixtla/mlforecast/blob/main/mlforecast/auto.py#L135"
target="_blank" style={{ float: "right", fontSize: "smaller" }}>source</a>

### AutoLightGBM

> ``` text
>  AutoLightGBM (config:Optional[Callable[[optuna.trial._trial.Trial],Dict[s
>                tr,Any]]]=None)
> ```

*Structure to hold a model and its search space*

|        | **Type** | **Default** | **Details**                                                      |
|------|------------------|-------------------------|-------------------------|
| config | Optional | None        | function that takes an optuna trial and produces a configuration |

------------------------------------------------------------------------

<a
href="https://github.com/Nixtla/mlforecast/blob/main/mlforecast/auto.py#L100"
target="_blank" style={{ float: "right", fontSize: "smaller" }}>source</a>

### random_forest_space

> ``` text
>  random_forest_space (trial:optuna.trial._trial.Trial)
> ```

------------------------------------------------------------------------

<a
href="https://github.com/Nixtla/mlforecast/blob/main/mlforecast/auto.py#L92"
target="_blank" style={{ float: "right", fontSize: "smaller" }}>source</a>

### elastic_net_space

> ``` text
>  elastic_net_space (trial:optuna.trial._trial.Trial)
> ```

------------------------------------------------------------------------

<a
href="https://github.com/Nixtla/mlforecast/blob/main/mlforecast/auto.py#L85"
target="_blank" style={{ float: "right", fontSize: "smaller" }}>source</a>

### lasso_space

> ``` text
>  lasso_space (trial:optuna.trial._trial.Trial)
> ```

------------------------------------------------------------------------

<a
href="https://github.com/Nixtla/mlforecast/blob/main/mlforecast/auto.py#L78"
target="_blank" style={{ float: "right", fontSize: "smaller" }}>source</a>

### ridge_space

> ``` text
>  ridge_space (trial:optuna.trial._trial.Trial)
> ```

------------------------------------------------------------------------

<a
href="https://github.com/Nixtla/mlforecast/blob/main/mlforecast/auto.py#L74"
target="_blank" style={{ float: "right", fontSize: "smaller" }}>source</a>

### linear_regression_space

> ``` text
>  linear_regression_space (trial:optuna.trial._trial.Trial)
> ```

------------------------------------------------------------------------

<a
href="https://github.com/Nixtla/mlforecast/blob/main/mlforecast/auto.py#L62"
target="_blank" style={{ float: "right", fontSize: "smaller" }}>source</a>

### catboost_space

> ``` text
>  catboost_space (trial:optuna.trial._trial.Trial)
> ```

------------------------------------------------------------------------

<a
href="https://github.com/Nixtla/mlforecast/blob/main/mlforecast/auto.py#L47"
target="_blank" style={{ float: "right", fontSize: "smaller" }}>source</a>

### xgboost_space

> ``` text
>  xgboost_space (trial:optuna.trial._trial.Trial)
> ```

------------------------------------------------------------------------

<a
href="https://github.com/Nixtla/mlforecast/blob/main/mlforecast/auto.py#L32"
target="_blank" style={{ float: "right", fontSize: "smaller" }}>source</a>

### lightgbm_space

> ``` text
>  lightgbm_space (trial:optuna.trial._trial.Trial)
> ```

------------------------------------------------------------------------

<a
href="https://github.com/Nixtla/mlforecast/blob/main/mlforecast/auto.py#L112"
target="_blank" style={{ float: "right", fontSize: "smaller" }}>source</a>

### AutoModel

> ``` text
>  AutoModel (model:sklearn.base.BaseEstimator,
>             config:Callable[[optuna.trial._trial.Trial],Dict[str,Any]])
> ```

*Structure to hold a model and its search space*

|        | **Type**      | **Details**                                                      |
|--------|---------------------------|-------------------------------------|
| model  | BaseEstimator | scikit-learn compatible regressor                                |
| config | Callable      | function that takes an optuna trial and produces a configuration |

------------------------------------------------------------------------

<a
href="https://github.com/Nixtla/mlforecast/blob/main/mlforecast/auto.py#L239"
target="_blank" style={{ float: "right", fontSize: "smaller" }}>source</a>

### AutoMLForecast

> ``` text
>  AutoMLForecast
>                  (models:Union[List[__main__.AutoModel],Dict[str,__main__.
>                  AutoModel]], freq:Union[int,str], season_length:int, init
>                  _config:Optional[Callable[[optuna.trial._trial.Trial],Dic
>                  t[str,Any]]]=None, fit_config:Optional[Callable[[optuna.t
>                  rial._trial.Trial],Dict[str,Any]]]=None,
>                  num_threads:int=1)
> ```

*Hyperparameter optimization helper*

|               | **Type** | **Default** | **Details**                                                                                            |
|------|------------------|-------------------------|-------------------------|
| models        | Union    |             | Auto models to be optimized.                                                                           |
| freq          | Union    |             | pandas’ or polars’ offset alias or integer denoting the frequency of the series.                       |
| season_length | int      |             | Length of the seasonal period. This is used for producing the feature space.                           |
| init_config   | Optional | None        | Function that takes an optuna trial and produces a configuration passed to the MLForecast constructor. |
| fit_config    | Optional | None        | Function that takes an optuna trial and produces a configuration passed to the MLForecast fit method.  |
| num_threads   | int      | 1           | Number of threads to use when computing the features.                                                  |

------------------------------------------------------------------------

<a
href="https://github.com/Nixtla/mlforecast/blob/main/mlforecast/auto.py#L431"
target="_blank" style={{ float: "right", fontSize: "smaller" }}>source</a>

### AutoMLForecast.fit

> ``` text
>  AutoMLForecast.fit
>                      (df:Union[pandas.core.frame.DataFrame,polars.datafram
>                      e.frame.DataFrame], n_windows:int, h:int,
>                      num_samples:int, refit:Union[bool,int]=False, loss:Op
>                      tional[Callable[[Union[pandas.core.frame.DataFrame,po
>                      lars.dataframe.frame.DataFrame],Union[pandas.core.fra
>                      me.DataFrame,polars.dataframe.frame.DataFrame]],float
>                      ]]=None, id_col:str='unique_id', time_col:str='ds',
>                      target_col:str='y',
>                      study_kwargs:Optional[Dict[str,Any]]=None,
>                      optimize_kwargs:Optional[Dict[str,Any]]=None)
> ```

*Carry out the optimization process. Each model is optimized
independently and the best one is trained on all data*

|                 | **Type**           | **Default** | **Details**                                                                                                                                                                                                    |
|------|------------------|-------------------------|-------------------------|
| df              | Union              |             | Series data in long format.                                                                                                                                                                                    |
| n_windows       | int                |             | Number of windows to evaluate.                                                                                                                                                                                 |
| h               | int                |             | Forecast horizon.                                                                                                                                                                                              |
| num_samples     | int                |             | Number of trials to run                                                                                                                                                                                        |
| refit           | Union              | False       | Retrain model for each cross validation window.<br/>If False, the models are trained at the beginning and then used to predict each window.<br/>If positive int, the models are retrained every `refit` windows. |
| loss            | Optional           | None        | Function that takes the validation and train dataframes and produces a float.<br/>If `None` will use the average SMAPE across series.                                                                           |
| id_col          | str                | unique_id   | Column that identifies each serie.                                                                                                                                                                             |
| time_col        | str                | ds          | Column that identifies each timestep, its values can be timestamps or integers.                                                                                                                                |
| target_col      | str                | y           | Column that contains the target.                                                                                                                                                                               |
| study_kwargs    | Optional           | None        | Keyword arguments to be passed to the optuna.Study constructor.                                                                                                                                                |
| optimize_kwargs | Optional           | None        | Keyword arguments to be passed to the optuna.Study.optimize method.                                                                                                                                            |
| **Returns**     | **AutoMLForecast** |             | **object with best models and optimization results**                                                                                                                                                           |

------------------------------------------------------------------------

<a
href="https://github.com/Nixtla/mlforecast/blob/main/mlforecast/auto.py#L547"
target="_blank" style={{ float: "right", fontSize: "smaller" }}>source</a>

### AutoMLForecast.predict

> ``` text
>  AutoMLForecast.predict (h:int, X_df:Union[pandas.core.frame.DataFrame,pol
>                          ars.dataframe.frame.DataFrame,NoneType]=None)
> ```

*“Compute forecasts*

|             | **Type**  | **Default** | **Details**                                                                                  |
|------|------------------|-------------------------|-------------------------|
| h           | int       |             | Number of periods to predict.                                                                |
| X_df        | Union     | None        | Dataframe with the future exogenous features. Should have the id column and the time column. |
| **Returns** | **Union** |             | **Predictions for each serie and timestep, with one column per model.**                      |

------------------------------------------------------------------------

<a
href="https://github.com/Nixtla/mlforecast/blob/main/mlforecast/auto.py#L575"
target="_blank" style={{ float: "right", fontSize: "smaller" }}>source</a>

### AutoMLForecast.save

> ``` text
>  AutoMLForecast.save (path:Union[str,pathlib.Path])
> ```

*Save AutoMLForecast objects*

|             | **Type** | **Details**                               |
|-------------|----------|-------------------------------------------|
| path        | Union    | Directory where artifacts will be stored. |
| **Returns** | **None** |                                           |

```python
from datasetsforecast.m4 import M4, M4Evaluation, M4Info
from sklearn.linear_model import Ridge
from sklearn.compose import ColumnTransformer
from sklearn.pipeline import make_pipeline
from sklearn.preprocessing import OneHotEncoder
```


```python
def train_valid_split(group):
    df, *_ = M4.load(directory='data', group=group)
    df['ds'] = df['ds'].astype('int')
    horizon = M4Info[group].horizon
    valid = df.groupby('unique_id').tail(horizon).copy()
    train = df.drop(valid.index).reset_index(drop=True)
    return train, valid
```


```python
ridge_pipeline = make_pipeline(
    ColumnTransformer(
        [('encoder', OneHotEncoder(), ['unique_id'])],
        remainder='passthrough',
    ),
    Ridge()
)
auto_ridge = AutoModel(ridge_pipeline, lambda trial: {f'ridge__{k}': v for k, v in ridge_space(trial).items()})
```


```python
optuna.logging.set_verbosity(optuna.logging.ERROR)
group = 'Weekly'
train, valid = train_valid_split(group)
train['unique_id'] = train['unique_id'].astype('category')
valid['unique_id'] = valid['unique_id'].astype(train['unique_id'].dtype)
info = M4Info[group]
h = info.horizon
season_length = info.seasonality
auto_mlf = AutoMLForecast(
    freq=1,
    season_length=season_length,
    models={
        'lgb': AutoLightGBM(),
        'ridge': auto_ridge,
    },
    fit_config=lambda trial: {'static_features': ['unique_id']},
    num_threads=2,
)
auto_mlf.fit(
    df=train,
    n_windows=2,
    h=h,
    num_samples=2,
    optimize_kwargs={'timeout': 60},
)
auto_mlf.predict(h)
```

|      | unique_id | ds   | lgb          | ridge        |
|------|-----------|------|--------------|--------------|
| 0    | W1        | 2180 | 35529.435224 | 36110.921202 |
| 1    | W1        | 2181 | 35521.764894 | 36195.175757 |
| 2    | W1        | 2182 | 35537.417268 | 36107.528852 |
| 3    | W1        | 2183 | 35538.058206 | 36027.139248 |
| 4    | W1        | 2184 | 35614.611211 | 36092.858489 |
| ...  | ...       | ...  | ...          | ...          |
| 4662 | W99       | 2292 | 15071.536978 | 15319.146221 |
| 4663 | W99       | 2293 | 15058.145278 | 15299.549555 |
| 4664 | W99       | 2294 | 15042.493434 | 15271.744712 |
| 4665 | W99       | 2295 | 15042.144846 | 15250.070504 |
| 4666 | W99       | 2296 | 15038.729044 | 15232.127800 |

