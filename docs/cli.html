---

title: CLI


keywords: fastai
sidebar: home_sidebar

summary: "Run the forecasting pipeline with configuration files"
description: "Run the forecasting pipeline with configuration files"
nb_path: "nbs/cli.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/cli.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="run_forecast" class="doc_header"><code>run_forecast</code><a href="https://github.com/Nixtla/mlforecast/tree/main/mlforecast/cli.py#L25" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>run_forecast</code>(<strong><code>config_file</code></strong>:<code>str</code>)</p>
</blockquote>
<p>Run the forecasting pipeline using the configuration defined in <code>config_file</code>.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Example">Example<a class="anchor-link" href="#Example"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>If you want to run the forecasting pipeline from the CLI you first need to save your data and define a configuration file. Sample configurations are provided in <code>sample_configs/local.yaml</code> and <code>sample_configs/distributed.yaml</code>.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Local">Local<a class="anchor-link" href="#Local"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We can run the forecasting pipeline defined in <code>sample_configs/local.yaml</code> by saving our data and using the following configuration:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;../sample_configs/local.yaml&#39;</span><span class="p">,</span> <span class="s1">&#39;rt&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">cfg</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="n">pprint</span><span class="p">(</span><span class="n">cfg</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>{&#39;backtest&#39;: {&#39;n_windows&#39;: 2, &#39;window_size&#39;: 7},
 &#39;data&#39;: {&#39;format&#39;: &#39;parquet&#39;,
          &#39;input&#39;: &#39;train&#39;,
          &#39;output&#39;: &#39;outputs&#39;,
          &#39;prefix&#39;: &#39;data&#39;},
 &#39;features&#39;: {&#39;date_features&#39;: [&#39;dayofweek&#39;, &#39;month&#39;, &#39;year&#39;],
              &#39;freq&#39;: &#39;D&#39;,
              &#39;lag_transforms&#39;: {1: [&#39;expanding_mean&#39;],
                                 7: [{&#39;rolling_mean&#39;: {&#39;window_size&#39;: 7}},
                                     {&#39;rolling_mean&#39;: {&#39;window_size&#39;: 14}}]},
              &#39;lags&#39;: [7, 14],
              &#39;num_threads&#39;: 2},
 &#39;forecast&#39;: {&#39;horizon&#39;: 7},
 &#39;local&#39;: {&#39;model&#39;: {&#39;name&#39;: &#39;sklearn.ensemble.RandomForestRegressor&#39;,
                     &#39;params&#39;: {&#39;max_depth&#39;: 7, &#39;n_estimators&#39;: 10}}}}
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This will look for a single file in the directory <code>data</code> called <code>train</code> (<code>data.prefix/data.input</code>).</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">Path</span><span class="p">(</span><span class="s1">&#39;data/train&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">is_file</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>True</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Then we just call <code>mlforecast</code> with this configuration.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>mlforecast ../sample_configs/local.yaml
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Split 1 MSE: 0.0232
Split 2 MSE: 0.0243
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We can see our results have been saved.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">list</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="s1">&#39;data/outputs&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">iterdir</span><span class="p">())</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[Path(&#39;data/outputs/valid_1.parquet&#39;),
 Path(&#39;data/outputs/valid_0.parquet&#39;),
 Path(&#39;data/outputs/forecast.parquet&#39;)]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Distributed">Distributed<a class="anchor-link" href="#Distributed"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We can also use the CLI to run the distributed forecasting pipeline. To do this we need to save our data in partitions and fill the distributed key of the configuration file (instead of local). A sample configuration is provided in <code>sample_configs/distributed.yaml</code>:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;../sample_configs/distributed.yaml&#39;</span><span class="p">,</span> <span class="s1">&#39;rt&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">cfg</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="n">pprint</span><span class="p">(</span><span class="n">cfg</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>{&#39;backtest&#39;: {&#39;n_windows&#39;: 2, &#39;window_size&#39;: 7},
 &#39;data&#39;: {&#39;format&#39;: &#39;parquet&#39;,
          &#39;input&#39;: &#39;train&#39;,
          &#39;output&#39;: &#39;outputs&#39;,
          &#39;prefix&#39;: &#39;data&#39;},
 &#39;distributed&#39;: {&#39;cluster&#39;: {&#39;class_kwargs&#39;: {&#39;memory_limit&#39;: &#39;4 GiB&#39;,
                                              &#39;n_workers&#39;: 2,
                                              &#39;threads_per_worker&#39;: 2},
                             &#39;class_name&#39;: &#39;dask.distributed.LocalCluster&#39;},
                 &#39;model&#39;: {&#39;name&#39;: &#39;LGBMForecast&#39;,
                           &#39;params&#39;: {&#39;eta&#39;: 0.3, &#39;max_depth&#39;: 7}}},
 &#39;features&#39;: {&#39;date_features&#39;: [&#39;dayofweek&#39;, &#39;month&#39;, &#39;year&#39;],
              &#39;freq&#39;: &#39;D&#39;,
              &#39;lag_transforms&#39;: {1: [&#39;expanding_mean&#39;],
                                 7: [{&#39;rolling_mean&#39;: {&#39;window_size&#39;: 7}},
                                     {&#39;rolling_min&#39;: {&#39;window_size&#39;: 7}}]},
              &#39;lags&#39;: [7, 14],
              &#39;num_threads&#39;: 2},
 &#39;forecast&#39;: {&#39;horizon&#39;: 7}}
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Notice that we use <code>cluster.class_name</code> to define the cluster that we want to instantiate, as well as its keyword arguments. This example will use a <code>dask.distributed.LocalCluster</code>, however you can fill any other cluster you want.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">list</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="s1">&#39;data/train&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">iterdir</span><span class="p">())</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[Path(&#39;data/train/part.1.parquet&#39;),
 Path(&#39;data/train/_common_metadata&#39;),
 Path(&#39;data/train/_metadata&#39;),
 Path(&#39;data/train/part.0.parquet&#39;)]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Note that we have split our data in two partitions and have specified that we want two workers from our cluster (<code>distributed.cluster.class_kwargs.n_workers</code>). <strong>If you're using a remote cluster use a remote storage like S3</strong>.</p>
<p>To run the pipeline we just call <code>mlforecast</code> with this configuration.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>mlforecast ../sample_configs/distributed.yaml
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We can see our results have been saved.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">list</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="s1">&#39;data/outputs&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">iterdir</span><span class="p">())</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[Path(&#39;data/outputs/valid_1&#39;),
 Path(&#39;data/outputs/valid_0&#39;),
 Path(&#39;data/outputs/forecast&#39;)]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

