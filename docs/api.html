---

title: API


keywords: fastai
sidebar: home_sidebar

summary: "High level functions for easy interaction"
description: "High level functions for easy interaction"
nb_path: "nbs/api.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/api.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">import</span> <span class="nn">tempfile</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">fastcore.test</span> <span class="kn">import</span> <span class="n">test_eq</span><span class="p">,</span> <span class="n">test_fail</span>
<span class="kn">from</span> <span class="nn">window_ops.rolling</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">window_ops.expanding</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">window_ops.ewm</span> <span class="kn">import</span> <span class="o">*</span>

<span class="kn">from</span> <span class="nn">mlforecast.utils</span> <span class="kn">import</span> <span class="n">generate_daily_series</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="validate_data_format" class="doc_header"><code>validate_data_format</code><a href="https://github.com/Nixtla/mlforecast/tree/main/mlforecast/api.py#L46" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>validate_data_format</code>(<strong><code>data</code></strong>:<code>Union</code>[<code>DataFrame</code>, <code>DataFrame</code>])</p>
</blockquote>
<p>Checks whether data is in the correct format and tries to fix it if possible.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">not_pandas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">])</span>
<span class="n">test_fail</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">validate_data_format</span><span class="p">(</span><span class="n">not_pandas</span><span class="p">),</span> <span class="n">contains</span><span class="o">=</span><span class="s1">&#39;data must be either pandas&#39;</span><span class="p">)</span>

<span class="n">no_uid</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">]})</span>
<span class="n">test_fail</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">validate_data_format</span><span class="p">(</span><span class="n">no_uid</span><span class="p">),</span> <span class="n">contains</span><span class="o">=</span><span class="s1">&#39;unique_id not found&#39;</span><span class="p">)</span>

<span class="n">uid_in_col</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;unique_id&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;ds&#39;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">([</span><span class="s1">&#39;2020-01-01&#39;</span><span class="p">]),</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">1.</span><span class="p">]})</span>
<span class="k">assert</span> <span class="n">validate_data_format</span><span class="p">(</span><span class="n">uid_in_col</span><span class="p">)</span><span class="o">.</span><span class="n">equals</span><span class="p">(</span><span class="n">uid_in_col</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;unique_id&#39;</span><span class="p">))</span>

<span class="n">no_ds</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;unique_id&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">]})</span>
<span class="n">test_fail</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">validate_data_format</span><span class="p">(</span><span class="n">no_ds</span><span class="p">),</span> <span class="n">contains</span><span class="o">=</span><span class="s1">&#39;ds column not found&#39;</span><span class="p">)</span>

<span class="n">ds_not_datetime</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;unique_id&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;ds&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;2020-01-01&#39;</span><span class="p">],</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">1.</span><span class="p">]})</span>
<span class="k">assert</span> <span class="n">is_datetime64_dtype</span><span class="p">(</span><span class="n">validate_data_format</span><span class="p">(</span><span class="n">ds_not_datetime</span><span class="p">)[</span><span class="s1">&#39;ds&#39;</span><span class="p">])</span>

<span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">dd</span><span class="p">,</span> <span class="s1">&#39;to_datetime&#39;</span><span class="p">):</span>
    <span class="n">ds_not_datetime_dask</span> <span class="o">=</span> <span class="n">dd</span><span class="o">.</span><span class="n">from_pandas</span><span class="p">(</span><span class="n">ds_not_datetime</span><span class="p">,</span> <span class="n">npartitions</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">is_datetime64_dtype</span><span class="p">(</span><span class="n">validate_data_format</span><span class="p">(</span><span class="n">ds_not_datetime_dask</span><span class="p">)</span><span class="o">.</span><span class="n">compute</span><span class="p">()[</span><span class="s1">&#39;ds&#39;</span><span class="p">])</span>
    
<span class="n">no_y</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;unique_id&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;ds&#39;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">([</span><span class="s1">&#39;2020-01-01&#39;</span><span class="p">])})</span>
<span class="n">test_fail</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">validate_data_format</span><span class="p">(</span><span class="n">no_y</span><span class="p">),</span> <span class="n">contains</span><span class="o">=</span><span class="s1">&#39;y column not found&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="read_data" class="doc_header"><code>read_data</code><a href="https://github.com/Nixtla/mlforecast/tree/main/mlforecast/api.py#L77" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>read_data</code>(<strong><code>config</code></strong>:<a href="/mlforecast/data_model.html#Data"><code>Data</code></a>, <strong><code>is_distributed</code></strong>:<code>bool</code>)</p>
</blockquote>
<p>Read data from <code>config.prefix/config.input</code>.</p>
<p>If we're in distributed mode dask is used for IO, else pandas.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">series</span> <span class="o">=</span> <span class="n">generate_daily_series</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>

<span class="k">for</span> <span class="n">data_format</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;csv&#39;</span><span class="p">,</span> <span class="s1">&#39;parquet&#39;</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">TemporaryDirectory</span><span class="p">()</span> <span class="k">as</span> <span class="n">tmpdir</span><span class="p">:</span>
        <span class="n">tmpdir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">tmpdir</span><span class="p">)</span>
        <span class="n">writer</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">series</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;to_</span><span class="si">{</span><span class="n">data_format</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">writer</span><span class="p">(</span><span class="n">tmpdir</span><span class="o">/</span><span class="sa">f</span><span class="s1">&#39;single_file.</span><span class="si">{</span><span class="n">data_format</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">data_cfg</span> <span class="o">=</span> <span class="n">Data</span><span class="p">(</span><span class="n">prefix</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">tmpdir</span><span class="p">),</span> <span class="nb">input</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;single_file.</span><span class="si">{</span><span class="n">data_format</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="s1">&#39;output&#39;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="n">data_format</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">read_data</span><span class="p">(</span><span class="n">data_cfg</span><span class="p">,</span> <span class="n">is_distributed</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">equals</span><span class="p">(</span><span class="n">series</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">np</span><span class="o">.</span><span class="n">testing</span><span class="o">.</span><span class="n">assert_allclose</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">series</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">series_ddf</span> <span class="o">=</span> <span class="n">dd</span><span class="o">.</span><span class="n">from_pandas</span><span class="p">(</span><span class="n">series</span><span class="p">,</span> <span class="n">npartitions</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="k">for</span> <span class="n">data_format</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;csv&#39;</span><span class="p">,</span> <span class="s1">&#39;parquet&#39;</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">TemporaryDirectory</span><span class="p">()</span> <span class="k">as</span> <span class="n">tmpdir</span><span class="p">:</span>
        <span class="n">tmpdir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">tmpdir</span><span class="p">)</span>
        <span class="n">writer</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">series_ddf</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;to_</span><span class="si">{</span><span class="n">data_format</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">writer</span><span class="p">(</span><span class="n">tmpdir</span><span class="o">/</span><span class="s1">&#39;partitions&#39;</span><span class="p">)</span>
        <span class="n">data_cfg</span> <span class="o">=</span> <span class="n">Data</span><span class="p">(</span><span class="n">prefix</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">tmpdir</span><span class="p">),</span> <span class="nb">input</span><span class="o">=</span><span class="s1">&#39;partitions&#39;</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="s1">&#39;output&#39;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="n">data_format</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">read_data</span><span class="p">(</span><span class="n">data_cfg</span><span class="p">,</span> <span class="n">is_distributed</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span><span class="o">.</span><span class="n">equals</span><span class="p">(</span><span class="n">series</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">np</span><span class="o">.</span><span class="n">testing</span><span class="o">.</span><span class="n">assert_allclose</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">compute</span><span class="p">(),</span> <span class="n">series</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="fcst_from_config" class="doc_header"><code>fcst_from_config</code><a href="https://github.com/Nixtla/mlforecast/tree/main/mlforecast/api.py#L148" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>fcst_from_config</code>(<strong><code>config</code></strong>:<a href="/mlforecast/data_model.html#Config"><code>Config</code></a>)</p>
</blockquote>
<p>Instantiate Forecast class from config.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;../sample_configs/local.yaml&#39;</span><span class="p">,</span> <span class="s1">&#39;rt&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">cfg</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="o">**</span><span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">f</span><span class="p">))</span>

<span class="n">fcst</span> <span class="o">=</span> <span class="n">fcst_from_config</span><span class="p">(</span><span class="n">cfg</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">fcst</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">cfg</span><span class="o">.</span><span class="n">local</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="n">model_params</span> <span class="o">=</span> <span class="n">fcst</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">get_params</span><span class="p">()</span>
<span class="k">for</span> <span class="n">param_name</span><span class="p">,</span> <span class="n">param_value</span> <span class="ow">in</span> <span class="n">cfg</span><span class="o">.</span><span class="n">local</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">test_eq</span><span class="p">(</span><span class="n">model_params</span><span class="p">[</span><span class="n">param_name</span><span class="p">],</span> <span class="n">param_value</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">client</span> <span class="o">=</span> <span class="n">Client</span><span class="p">(</span><span class="n">n_workers</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;../sample_configs/distributed.yaml&#39;</span><span class="p">,</span> <span class="s1">&#39;rt&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">cfg</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="o">**</span><span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">f</span><span class="p">))</span>

<span class="n">fcst</span> <span class="o">=</span> <span class="n">fcst_from_config</span><span class="p">(</span><span class="n">cfg</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">fcst</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">cfg</span><span class="o">.</span><span class="n">distributed</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
<span class="n">model_params</span> <span class="o">=</span> <span class="n">fcst</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">get_params</span><span class="p">()</span>
<span class="k">for</span> <span class="n">param_name</span><span class="p">,</span> <span class="n">param_value</span> <span class="ow">in</span> <span class="n">cfg</span><span class="o">.</span><span class="n">distributed</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">test_eq</span><span class="p">(</span><span class="n">model_params</span><span class="p">[</span><span class="n">param_name</span><span class="p">],</span> <span class="n">param_value</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="perform_backtest" class="doc_header"><code>perform_backtest</code><a href="https://github.com/Nixtla/mlforecast/tree/main/mlforecast/api.py#L168" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>perform_backtest</code>(<strong><code>fcst</code></strong>:<code>Union</code>[<a href="/mlforecast/forecast.html#Forecast"><code>Forecast</code></a>, <a href="/mlforecast/distributed.forecast.html#DistributedForecast"><code>DistributedForecast</code></a>], <strong><code>data</code></strong>:<code>Union</code>[<code>DataFrame</code>, <code>DataFrame</code>], <strong><code>config</code></strong>:<a href="/mlforecast/data_model.html#Config"><code>Config</code></a>, <strong><code>output_path</code></strong>:<code>Union</code>[<code>Path</code>, <code>S3Path</code>])</p>
</blockquote>
<p>Performs backtesting of <code>fcst</code> using <code>data</code> and the strategy defined in <code>config</code>.
Writes the results to <code>output_path</code>.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;../sample_configs/local.yaml&#39;</span><span class="p">,</span> <span class="s1">&#39;rt&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">cfg</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="o">**</span><span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">f</span><span class="p">))</span>

<span class="n">fcst</span> <span class="o">=</span> <span class="n">fcst_from_config</span><span class="p">(</span><span class="n">cfg</span><span class="p">)</span>
<span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">TemporaryDirectory</span><span class="p">()</span> <span class="k">as</span> <span class="n">tmpdir</span><span class="p">:</span>
    <span class="n">perform_backtest</span><span class="p">(</span><span class="n">fcst</span><span class="p">,</span> <span class="n">series</span><span class="p">,</span> <span class="n">cfg</span><span class="p">,</span> <span class="n">Path</span><span class="p">(</span><span class="n">tmpdir</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Split 1 MSE: 0.0217
Split 2 MSE: 0.0248
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;../sample_configs/distributed.yaml&#39;</span><span class="p">,</span> <span class="s1">&#39;rt&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">cfg</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="o">**</span><span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">f</span><span class="p">))</span>

<span class="n">fcst</span> <span class="o">=</span> <span class="n">fcst_from_config</span><span class="p">(</span><span class="n">cfg</span><span class="p">)</span>
<span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">TemporaryDirectory</span><span class="p">()</span> <span class="k">as</span> <span class="n">tmpdir</span><span class="p">:</span>
    <span class="n">perform_backtest</span><span class="p">(</span><span class="n">fcst</span><span class="p">,</span> <span class="n">series_ddf</span><span class="p">,</span> <span class="n">cfg</span><span class="p">,</span> <span class="n">Path</span><span class="p">(</span><span class="n">tmpdir</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Split 1 MSE: 0.0313
Split 2 MSE: 0.0322
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">client</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="parse_config" class="doc_header"><code>parse_config</code><a href="https://github.com/Nixtla/mlforecast/tree/main/mlforecast/api.py#L195" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>parse_config</code>(<strong><code>config_file</code></strong>:<code>str</code>)</p>
</blockquote>
<p>Create a <a href="/mlforecast/data_model.html#Config"><code>Config</code></a> object using the contents of <code>config_file</code></p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="setup_client" class="doc_header"><code>setup_client</code><a href="https://github.com/Nixtla/mlforecast/tree/main/mlforecast/api.py#L201" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>setup_client</code>(<strong><code>config</code></strong>:<a href="/mlforecast/data_model.html#Cluster"><code>Cluster</code></a>)</p>
</blockquote>
<p>Spins up a cluster and returns a client connected to it.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">client</span> <span class="o">=</span> <span class="n">setup_client</span><span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">distributed</span><span class="o">.</span><span class="n">cluster</span><span class="p">)</span>
<span class="n">client</span><span class="o">.</span><span class="n">cluster</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="n">client</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="run_forecast" class="doc_header"><code>run_forecast</code><a href="https://github.com/Nixtla/mlforecast/tree/main/mlforecast/api.py#L212" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>run_forecast</code>(<strong><code>config_file</code></strong>:"Configuration file")</p>
</blockquote>
<p>Run the forecasting pipeline using the configuration defined in <code>config_file</code>.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">data_format</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;csv&#39;</span><span class="p">,</span> <span class="s1">&#39;parquet&#39;</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">df</span> <span class="ow">in</span> <span class="p">(</span><span class="n">series</span><span class="p">,</span> <span class="n">series_ddf</span><span class="p">):</span>
        <span class="n">data_is_dask</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">dd_Frame</span><span class="p">)</span>
        <span class="n">config_name</span> <span class="o">=</span> <span class="s1">&#39;distributed.yaml&#39;</span> <span class="k">if</span> <span class="n">data_is_dask</span> <span class="k">else</span> <span class="s1">&#39;local.yaml&#39;</span>
        <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">TemporaryDirectory</span><span class="p">()</span> <span class="k">as</span> <span class="n">tmpdir</span><span class="p">:</span>
            <span class="n">tmpdir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">tmpdir</span><span class="p">)</span>
            <span class="n">train_path</span> <span class="o">=</span> <span class="s1">&#39;train&#39;</span>
            <span class="n">config_path</span> <span class="o">=</span> <span class="n">tmpdir</span><span class="o">/</span><span class="n">config_name</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">data_is_dask</span><span class="p">:</span>
                <span class="n">train_path</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;.</span><span class="si">{</span><span class="n">data_format</span><span class="si">}</span><span class="s1">&#39;</span>
            <span class="n">writer</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;to_</span><span class="si">{</span><span class="n">data_format</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">writer</span><span class="p">(</span><span class="n">tmpdir</span><span class="o">/</span><span class="n">train_path</span><span class="p">)</span>

            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;../sample_configs/</span><span class="si">{</span><span class="n">config_name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;rt&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">cfg</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
            <span class="n">cfg</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;prefix&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">tmpdir</span><span class="p">)</span>
            <span class="n">cfg</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;input&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train_path</span>
            <span class="n">cfg</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;format&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data_format</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">config_path</span><span class="p">,</span> <span class="s1">&#39;wt&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">yaml</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">cfg</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
            <span class="n">run_forecast</span><span class="p">(</span><span class="n">config_path</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Split 1 MSE: 0.0218
Split 2 MSE: 0.0246
Split 1 MSE: 0.0313
Split 2 MSE: 0.0322
Split 1 MSE: 0.0214
Split 2 MSE: 0.0240
Split 1 MSE: 0.0313
Split 2 MSE: 0.0322
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>mkdir data
<span class="n">series</span><span class="o">.</span><span class="n">to_parquet</span><span class="p">(</span><span class="s1">&#39;data/train&#39;</span><span class="p">)</span>
<span class="o">!</span>mlforecast ../sample_configs/local.yaml
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Split 1 MSE: 0.0215
Split 2 MSE: 0.0237
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>ls data/outputs/
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>forecast.parquet  valid_0.parquet  valid_1.parquet
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>rm -rf data
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

</div>
 

