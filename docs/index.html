---

title: mlforecast


keywords: fastai
sidebar: home_sidebar

summary: "Scalable machine learning based time series forecasting."
description: "Scalable machine learning based time series forecasting."
nb_path: "nbs/index.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/index.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><img src="https://img.shields.io/github/workflow/status/Nixtla/mlforecast/CI" alt="CI">
<img src="https://img.shields.io/pypi/pyversions/mlforecast" alt="Python">
<img src="https://img.shields.io/pypi/v/mlforecast" alt="PyPi">
<img src="https://img.shields.io/github/license/Nixtla/mlforecast" alt="License"></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Install">Install<a class="anchor-link" href="#Install"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><code>pip install mlforecast</code></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Optional-dependencies">Optional dependencies<a class="anchor-link" href="#Optional-dependencies"> </a></h3><p>If you want more functionality you can instead use <code>pip install mlforecast[extra1, extra2, ...]</code>. The current extra dependencies are:</p>
<ul>
<li><strong>aws</strong>: adds the functionality to use S3 as the storage in the CLI.</li>
<li><strong>cli</strong>: includes the validations necessary to use the CLI.</li>
<li><strong>distributed</strong>: installs <a href="https://dask.org/">dask</a> to perform distributed training. Note that you'll also need to install either <a href="https://github.com/microsoft/LightGBM/tree/master/python-package">lightgbm</a> or <a href="https://xgboost.readthedocs.io/en/latest/install.html#python">xgboost</a>.</li>
</ul>
<p>For example, if you want to perform distributed training through the CLI using S3 as your storage you'll need all three extras, which you can get using: <code>pip install mlforecast[aws, cli, distributed]</code>.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="How-to-use">How to use<a class="anchor-link" href="#How-to-use"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Programmatic-API">Programmatic API<a class="anchor-link" href="#Programmatic-API"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Store your time series in a pandas dataframe with an index named <strong>unique_id</strong> that identifies each time serie, a column <strong>ds</strong> that contains the datestamps and a column <strong>y</strong> with the values.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">mlforecast.utils</span> <span class="kn">import</span> <span class="n">generate_daily_series</span>

<span class="n">series</span> <span class="o">=</span> <span class="n">generate_daily_series</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
<span class="n">display_df</span><span class="p">(</span><span class="n">series</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Then define your flow configuration. This includes lags, transformations on the lags and date features. The lag transformations are defined as <a href="http://numba.pydata.org/">numba</a> <em>jitted</em> functions that transform an array, if they have additional arguments you supply a tuple (<code>transform_func</code>, <code>arg1</code>, <code>arg2</code>, ...).</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">window_ops.expanding</span> <span class="kn">import</span> <span class="n">expanding_mean</span>
<span class="kn">from</span> <span class="nn">window_ops.rolling</span> <span class="kn">import</span> <span class="n">rolling_mean</span>

<span class="n">flow_config</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
    <span class="n">lags</span><span class="o">=</span><span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="mi">14</span><span class="p">],</span>
    <span class="n">lag_transforms</span><span class="o">=</span><span class="p">{</span>
        <span class="mi">1</span><span class="p">:</span> <span class="p">[</span><span class="n">expanding_mean</span><span class="p">],</span>
        <span class="mi">7</span><span class="p">:</span> <span class="p">[(</span><span class="n">rolling_mean</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span> <span class="p">(</span><span class="n">rolling_mean</span><span class="p">,</span> <span class="mi">14</span><span class="p">)]</span>
    <span class="p">},</span>
    <span class="n">date_features</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;dayofweek&#39;</span><span class="p">,</span> <span class="s1">&#39;month&#39;</span><span class="p">]</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Next define a model. If you want to use the local interface this can be any regressor that follows the scikit-learn API. For distributed training there are <a href="/mlforecast/distributed.models.lgb.html#LGBMForecast"><code>LGBMForecast</code></a> and <a href="/mlforecast/distributed.models.xgb.html#XGBForecast"><code>XGBForecast</code></a>.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestRegressor</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">RandomForestRegressor</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now instantiate your forecast object with the model and the flow configuration. There are two types of forecasters, <a href="/mlforecast/forecast.html#Forecast"><code>Forecast</code></a> which is local and <a href="/mlforecast/distributed.forecast.html#DistributedForecast"><code>DistributedForecast</code></a> which performs the whole process in a distributed way.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">mlforecast.forecast</span> <span class="kn">import</span> <span class="n">Forecast</span>

<span class="n">fcst</span> <span class="o">=</span> <span class="n">Forecast</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">flow_config</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>To compute the features and train the model using them call <code>.fit</code> on your <a href="/mlforecast/forecast.html#Forecast"><code>Forecast</code></a> object.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">fcst</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">series</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>To get the forecasts for the next 14 days call <code>.predict(14)</code> on the forecaster. This will update the target with each prediction and recompute the features to get the next one.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">predictions</span> <span class="o">=</span> <span class="n">fcst</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="mi">14</span><span class="p">)</span>

<span class="n">display_df</span><span class="p">(</span><span class="n">predictions</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="CLI">CLI<a class="anchor-link" href="#CLI"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>If you're looking for computing quick baselines, want to avoid some boilerplate or just like using CLIs better then you can use the <code>mlforecast</code> binary with a configuration file like the following:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>cat sample_configs/local.yaml
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The configuration is validated using <a href="/mlforecast/data_model.html#FlowConfig"><code>FlowConfig</code></a>.</p>
<p>This configuration will use the data in <code>data.prefix/data.input</code> to train and write the results to <code>data.prefix/data.output</code> both with <code>data.format</code>.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>mlforecast sample_configs/local.yaml
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">list</span><span class="p">((</span><span class="n">data_path</span><span class="o">/</span><span class="s1">&#39;outputs&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">iterdir</span><span class="p">())</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

</div>
 

